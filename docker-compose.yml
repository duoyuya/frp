version: '3.8'

services:
  frp-panel:
    image: ghcr.io/duoyuya/frp:latest
    container_name: frp-panel
    restart: unless-stopped
    ports:
      - "${PANEL_PORT:-3000}:3000"
      - "${FRP_BIND_PORT:-7000}:7000"
      - "${FRP_DASHBOARD_PORT:-7500}:7500"
      - "10000-10100:10000-10100"
    volumes:
      - ./data:/app/data
      - ./frp:/app/frp
    environment:
      - NODE_ENV=production
      - NODE_OPTIONS=--max-old-space-size=256
      - PORT=3000
      - JWT_SECRET=${JWT_SECRET:-change-this-secret}
      - ADMIN_USERNAME=${ADMIN_USERNAME:-admin}
      - ADMIN_PASSWORD=${ADMIN_PASSWORD:-admin123456}
      - SMTP_HOST=${SMTP_HOST:-}
      - SMTP_PORT=${SMTP_PORT:-587}
      - SMTP_USER=${SMTP_USER:-}
      - SMTP_PASS=${SMTP_PASS:-}
      - SMTP_FROM=${SMTP_FROM:-}
      - FRP_BIND_PORT=${FRP_BIND_PORT:-7000}
      - FRP_TOKEN=${FRP_TOKEN:-change-this-token}
      - FRP_DASHBOARD_PORT=${FRP_DASHBOARD_PORT:-7500}
      - USER_PORT_MIN=10000
      - USER_PORT_MAX=10100
      - USER_PORT_LIMIT=5
      - DB_PATH=/app/data/frp-panel.db
    deploy:
      resources:
        limits:
          memory: 384M
        reservations:
          memory: 128M
